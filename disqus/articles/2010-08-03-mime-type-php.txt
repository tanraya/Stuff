title: "А как вы проверяете mime-type файлов в php?"
tags:
- apache2
- http
- mime-magic
- mime-type
- php
- zend-framework

<body><p>Как известно, все загружаемые на сервер файлы нужно проверять на соответствие разрешенным <em>mime-type</em>. Большинство программистов проверяют это соответствие, сверяясь с mime-типом из <em>$_FILES</em>, но этот mime-тип берется из заголовков <em>HTTP </em>запроса и может быть определен неправильно, т.к. определяет его браузер. У меня например, некоторые jpeg-файлы определяются как application/octet-stream и естественно, скрипт их не принимает. К тому же решение построенное на проверке mime-типа из HTTP заголовка потенциально опасно, т.к. заголовки можно подделать и указать любой mime-тип.

Как же сделать правильно?

Нужно установить расширение PECL, которое называется Fileinfo. Это расширение является заменой более старого расширения mime_magic. Валидатор MimeType в Zend Framework использует именно Fileinfo, как наиболее приоритетный способ определения mime-типа. Fileinfo определяет mime-тип по специальным сигнатурам, которые есть внутри файла.

Другой способ состоит в том, чтобы переложить определение mime-типа на веб-сервер. У веб-сервера Apache есть специальный файл magic с сигнатурами, с помощью которого он определяет, какого mime-типа является загружаемый файл, и устанавливает это значение в заголовок. Таким образом, в php скрипт придет верный mime-тип.

Для того, чтобы, Apache определял mime-тип файла, нужно включить модуль <em>mod_mime_magic</em>.

<em>Небольшой офф: не забывайте так же проверять тип файлов еще и по расширению.</em></p></body>
