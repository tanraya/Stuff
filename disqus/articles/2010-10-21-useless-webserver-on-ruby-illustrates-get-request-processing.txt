title: "Я написал веб-сервер, который ничего не умеет"
tags:
- ruby
- web-server

<body>
<p>И, спрашивается, зачем?

А затем, чтобы рассказать на примере, как обрабатываются GET-запросы. Пока что мой сервер ничего не умеет, кроме обработки GET-запросов и вывода информации о клиенте, он даже не читает никакие файлы с диска. Его задача другая, показать, как происходит обработка запросов. Я это сделал потому, что как оказалось, далеко не все веб-разработчики понимают, как это происходит. Мне вот повезло, давным давно приходилось разбирать аж multipart-запросы и обрабатывать заголовки, приходящие на сервер - в бытность, когда писал свою библиотеку на Perl.

Но сейчас я сделал пример на Ruby и не поймет его только баран (или обезьяна). Я постарался максимально документировать его, чтобы было все понятно.

</p>
<div class="gist-wrapper"><script src="https://gist.github.com/1768855.js?file=gistfile1.rb"></script></div>

Я создал TCP-сервер при помощи объекта TCPServer, но можно было сделать и на чистом объекте Socket. Просто TCPServer, который наследуется от TCPSocket, а тот, в свою очередь, от Socket - уже настроен для того, чтобы быть сервером, то есть он умеет висеть на определенном хосте и порту и ожидать входящие соединения.

Из кода видно, что:
<ul>
<li>Веб-сервер обрабатывает только GET-запрос</li>
	<li>Он не читает никаких файлов с диска, а просто отображает информацию о клиенте, который к нему присоединился</li>
	<li>Всегда отвечает со статусом 200</li>
</ul>
Можно сохранить код в файл server.rb, а затем запустить его:

<em>ruby server.rb</em>
</body>
